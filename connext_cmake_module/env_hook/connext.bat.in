set "_DEFAULT_NDDSHOME=@Connext_HOME@"
set "_DEFAULT_NDDSHOME=%_DEFAULT_NDDSHOME:/=\%"  :: Replace forward slashes with backslashes

:: Give priority to the NDDSHOME environment variable because the one detected at build time may
:: refer to an invalid path, e.g. for users using binaries.

:: Warn about changing the Connext location
if "%NDDSHOME%" NEQ "" (
  set "NDDSHOME=%NDDSHOME:/=\%"  :: Replace forward slashes with backslashes
  if "%NDDSHOME%" NEQ "%_Connext_HOME%" (
    echo [connext_cmake_module] NDDSHOME environment variable is set to "%NDDSHOME%" which is different to the one used when the workspace was built: "%_DEFAULT_NDDSHOME%" 1>&2
  )
)

if "%NDDSHOME%" == "" (
  echo [connext_cmake_module] NDDSHOME environment variable not set. Using NDDSHOME that was detected when the workspace was built: "%NDDSHOME%" 1>&2
  set "NDDSHOME=%_DEFAULT_NDDSHOME%"
)

if not exist %OSPL_HOME% (
  echo [connext_cmake_module] Error: NDDSHOME environment variable does not point to a valid directory: " %NDDSHOME%" 1>&2
  set "_DEFAULT_OSPL_HOME="
  goto :eof
)

:: Call RTI's env setup script, piping stdout to nul, since they have echo on.
call "%NDDSHOME:/=\%\resource\scripts\rtisetenv_@Connext_ARCHITECTURE_NAME@.bat" 1> nul
set "_DEFAULT_NDDSHOME="
